---
title: "Computacion estadistica - Clase 6"
output: html_notebook
---

# Tabla de Contenido {#tabla-de-contenido}

-   [Descarga de datos y carga de `dplyr`](#descarga-de-datos-y-carga-de-dplyr)
-   [Agrupar y resumir con `group_by` + `summarise`](#agrupar-y-resumir-con-group_by--summarise)
-   [Filtrar](#filtrar)
-   [Joins](#joins)
-   [Gr√°ficos](#gr√°ficos)
    -   [Gr√°fico de barras](#gr√°fico-de-barras)
    -   [Histogramas](#histogramas)
    -   [Boxplot ("Gr√°fico de caja")](#boxplot-gr√°fico-de-caja)

# Carga de datos `marketing.csv` y carga de `dplyr` {#descarga-de-datos-y-carga-de-dplyr}

```{r}
library(readr)
marketing <- read_csv("BD/marketing.csv")
marketing

library(dplyr)
```

[üîù Volver a tabla de contenido](#tabla-de-contenido)

# Agrupar y resumir con `group_by` + `summarise`

> Si analizas cada uno, va de lo grande a lo chico, de lo general a lo espec√≠fico.

Ingreso promedio por nivel educativo:

```{r}
marketing %>% 
  group_by(Education) %>% 
  summarise(Ingreso = mean(Income, na.rm = TRUE)) # remove NA = TRUE
```

Ingreso promedio por educaci√≥n y estado civil:

```{r}
marketing %>% 
  group_by(Education, Marital_Status) %>% 
  summarise(Ingreso = mean(Income, na.rm = TRUE))
```

[üîù Volver a tabla de contenido](#tabla-de-contenido)

# Filtrar {#filtrar}

Solo personas casadas:

```{r}
marketing %>% filter(Marital_Status == "Married")
```

Casados o divorciados (nivel pollito üòÑ):

```{r}
marketing %>% filter(Marital_Status %in% c("Married", "Divorced"))
```

*Evitar uso de notaci√≥n cient√≠fica*

```{r}
options(scipen = 99)
```

[üîù Volver a tabla de contenido](#tabla-de-contenido)

# joins {#joins}

| Funci√≥n        | Qu√© hace                                          |
|----------------|---------------------------------------------------|
| `filter()`     | Filtra filas (por ejemplo, solo 2020)             |
| `left_join()`  | Une dos tablas, conservando todo lo de la primera |
| `right_join()` | Conserva todo lo de la segunda                    |
| `full_join()`  | Conserva todo de ambas                            |
| `select(-col)` | Elimina una columna antes de unir                 |

> Para esta parte, se necesita cargar al entorno R el archivo `datos_economicos.RData`, que trae las siquientes tablas:

```{r}
df_balanza
df_desempleo
df_inflacion
df_pib
```

**Filtremos** para obtener los datos del **pib**, **desempleo** e **inflacion** del a√±o **2020:**

```{r}
pib20 = df_pib %>% filter(a√±o == 2020)        # PIB solo 2020
des20 = df_desempleo %>% filter(a√±o == 2020)  # Desempleo 2020
inf20 = df_inflacion %>% filter(a√±o == 2020)  # Inflaci√≥n 2020
```

```{r}
pib20
des20 
inf20 
```

Ahora hagamos consultas sobre estos datos usando **joins**.

-   üß† ‚ÄúUne la informaci√≥n de **PIB 2020** con la de **inflaci√≥n** por **pa√≠s y a√±o**, manteniendo todos los datos del PIB del 2020 y agregando la inflaci√≥n *solo si existe una coincidencia*.‚Äù:

```{r}
tabla_left <- left_join(pib20, inf20, by = c('pais', 'a√±o'))
tabla_left
```



> En `dplyr`, el argumento `by` funciona como si estuvieras indicando las claves (o "keys") por las que se deben unir las tablas, igual que har√≠as con una clave primaria y una clave for√°nea en bases de datos.

-   üß† ‚ÄúUne la informaci√≥n de **inflaci√≥n** a los datos del **PIB 2020** **solo por pa√≠s**, **sin considerar el a√±o**,manteniendo todos los datos del PIB del 2020 y agregando la inflaci√≥n *solo si existe una coincidencia*.‚Äù 
Esto puede provocar uniones incorrectas si hay varias filas por pa√≠s en alguna tabla.:

```{r}
tabla_left1 = left_join(pib20, inf20 %>% select(-a√±o), by = "pais")
# inf20 %>% select(-a√±o): elimina la columna a√±o antes del join.
tabla_left1
```

-   üß† ‚ÄúUne la informaci√≥n del **PIB del 2020** a los datos de **inflaci√≥n del 2020**, conservando todos los pa√≠ses con datos de **inflaci√≥n** y agregando el **PIB** *solo si hay coincidencia por pa√≠s y a√±o*.‚Äù:

```{r}
tabla_right = right_join(pib20, inf20, by = c("pais", "a√±o"))
tabla_right
```

-   üß† ‚ÄúUne la informaci√≥n de **inflaci√≥n** a los datos de **desempleo** por **pa√≠s y a√±o**, manteniendo **todos los datos de desempleo** aunque no haya registro de inflaci√≥n para ese pa√≠s y a√±o.( agregando la inflaci√≥n *solo si existe una coincidencia*)‚Äù:

```{r}
# left_join(df_desempleo, df_inflacion, by = c("pais", "a√±o")) %>% View()

left_join(df_desempleo, df_inflacion, by = c("pais", "a√±o"))
```

-   üß† ‚ÄúDame todos los pa√≠ses que est√©n en cualquiera de las dos tablas, aunque no coincidan. // Combina todos los datos de desempleo e inflaci√≥n por pa√≠s y a√±o, incluso si no hay coincidencias entre ambas tablas.‚Äù:

```{r}
# full_join(df_desempleo, df_inflacion, by = c("pais", "a√±o")) %>% View()
full_join(df_desempleo, df_inflacion, by = c("pais", "a√±o"))
```

[üîù Volver a tabla de contenido](#tabla-de-contenido)

# Gr√°ficos {#gr√°ficos}

```{r}
table(marketing$Education) 
# Cuenta cu√°ntas veces aparece cada nivel educativo
# Devuelve una tabla de frecuencias
```

## Gr√°fico de barras {#gr√°fico-de-barras}

```{r}
barplot(table(marketing$Education))
# Muestra un gr√°fico de barras b√°sico con los conteos anteriores

x = table(marketing$Education)
barplot(x, main = "Nivel educativo", xlab = "Educacion", ylab = "Conteo", 
        col = c("red", "magenta", "purple", "violetred", "pink"))
```

[üîù Volver a tabla de contenido](#tabla-de-contenido)

## Histogramas {#histogramas}

```{r}
hist(marketing$Income)

hist(marketing$Income, xlim = c(0, 150000), breaks = 30, col = rainbow(10))

```

-   `xlim=c(0, 150000)`: recorta eje X
-   `breaks=30`: m√°s detalle en los bloques
-   `col=rainbow(10)`: paleta de 10 colores

```{r}
histo1 = hist(marketing$Income, xlim = c(0, 150000), breaks = 50, col = rainbow(10))
```

[üîù Volver a tabla de contenido](#tabla-de-contenido)

## Boxplot ("Gr√°fico de caja") {#boxplot-gr√°fico-de-caja}

Filtra para eliminar ingresos extremos (outliers): 
```{r}
marketing2 = marketing %>% filter(Income <= 200000)
```

Creamos el grafico de cajas

```{r}
cajita = boxplot(marketing2$Income, col = "orange")
```

### Mostramos cuartiles

```{r}
cajita$stats
```
`cajita$stats` Muestra: m√≠nimo, 1er cuartil, mediana, 3er cuartil, m√°ximo.


### Muestra los valores at√≠picos detectados

```{r}
cajita$out
```

[üîù Volver a tabla de contenido](#tabla-de-contenido)
